---
title: "PA2_StormData.Rmd"
author: "Willianto"
date: "20/04/2020"
output: html_document
---

## Severe Weather Events in USA Impact on Health and Economy

### Sypnosis

Storms and other severe weather events can cause both public health and economic problems for communities and municipalities. Many severe events can result in fatalities, injuries, and property damage, and preventing such outcomes to the extent possible is a key concern.

The U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage.

The database between 1950 and 2011 can be downloaded at the following link:
https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2

An additional database documentation on how some of the variables are constructed/defined can be found here:
https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf

This report will use the NOAA Storm Database to answer the following two questions:

1. Across the United States, which types of events are most harmful with respect to population health?

2. Across the United States, which types of events have the greatest economic consequences?

The result with graphs and conclusion will be displayed in the last part.


```{r load_packages, include=FALSE}
library(knitr)
library(lattice)
library(lubridate)
```

```{r setoptions, echo=FALSE}
## Setting Global Option where echo = true so that someone will be able to read the code and results.
knitr::opts_chunk$set(echo = TRUE, results = "asis", tidy = FALSE)
```

### Data Processing
To process the data we will be dividing this into three seperate processes. 

Firstly we will need to download the data directly from the link provided. Once the data is downloaded we will look at the at different variables needed to solve the two questions on the impact on health and economy. 

Secondly to solve the question on the health impact there are two variables that we need to analyse namely FATALITIES and INJURIES. This will be elaborated further in the processes below

Thirdly to solve the question on economic impact there are four variables that we need to analyse namely CROPDMGEXP, CROPDMG, PROPDMGEXP and PROPDMG. 
'CROPDMGEXP' is the exponent values for 'CROPDMG' (crop damage). In the same way, 'PROPDMGEXP' is the exponent values for 'PROPDMG' (property damage). You should use both to get the total values for crops and property damage. (B or b = Billion, M or m = Million, K or k = Thousand, H or h = Hundred). This will be elaborated further in the processes below


```{r, DownloadingData, cache = TRUE}
## Part 1: Download data from the link provided in the sypnosis and read csv bz2 file and assign it to variable data.

## Set the URL
url <- 'https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2'  

## Download the file and checked that the bz2 file is 46.8 MB (49,177,144 bytes) according to the info in week 4 forum discussion.
download.file(url, destfile='repdata-data-StormData.csv.bz2', mode='wb')  

## Read the csv bz file and assign to data.
data <- read.csv("repdata-data-StormData.csv.bz2", header = TRUE, sep = ",", na.strings = "NA")

## Look at the total number of observations and variables whether it is the same as the Week 4 Forum discussion which is 902297 records and 37 variables.
dim(data)
```

Based on the data downloaded there are 902297 records and 37 variables.



```{r, ProcessFatalitiesInjuries}
##Part 2: Using the Aggregate and CBIND function to get the total number of FATALITIES and INJURIES based on the EVTYPE. Then we move on to total the FATALITIES + INJURIES based on the EVTYPE. Next we use the MERGE function to combine these two data together.

## Using Aggregate and CBIND to sum the total FATALITIES and INJURIES based on EVTYPE and assign it to fatInj
fatInj <- aggregate(cbind(FATALITIES,INJURIES)~EVTYPE,data = data, FUN = sum, na.rm = TRUE)

## Assign the column with names for the new table.
names(fatInj) <- c("EVENT TYPE", "FATALITIES", "INJURIES")

## Rank the top INJURIES based on EVTYPE
injuriesRank <- fatInj[order(-fatInj$INJURIES), ]

## Rank the top FATALITIES based on EVTYPE
fatalitiesRank <- fatInj[order(-fatInj$FATALITIES), ]

## Top 10 INJURIES causing EVTYPE
topInjuries <- kable(injuriesRank[1:10,])
topInjuries

## Top 10 FATALITIES causing EVTYPE
topFatalities <- kable(fatalitiesRank[1:10,])
topFatalities
```

```{r, ProcessTotalFatalitiesInjuries}
## Using Aggregate function to sum the FATALITIES + INJURIES based on EVTYPE and assign it to totalImpact
totalImpact <- aggregate((FATALITIES + INJURIES) ~ EVTYPE, data = data, FUN = sum, na.rm = TRUE)

## Assign the column with name the new table of the total FATALITIES and INJURIES combined.
names(totalImpact) <- c("EVENT TYPE", "Total FATALITIES & INJURIES")

## Rank the top combine impact of FATALITIES + INJURIES
totalImpactRank <- totalImpact[order(-totalImpact$'Total FATALITIES & INJURIES'), ]

## Top 10 Total FATALITIES + INJURIES causing EVTYPE
TopImpact <- kable(totalImpactRank[1:10,])
TopImpact
```

```{r, ProcessMergingTwoData}
## Using the Merge function to combine the two data together to show the health impact
healthImpact <- merge(fatInj, totalImpact)

## Rank the top health impact on the new combined data
healthImpactRank <- healthImpact[order(-healthImpact$'Total FATALITIES & INJURIES'), ]

## Top 10 Total Health Impact (FATALITIES + INJURIES) causing EVTYPE
TopHealthImpact <- kable(healthImpactRank[1:10,])
TopHealthImpact
```